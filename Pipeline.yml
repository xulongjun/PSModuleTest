trigger:
- none

pool:
  vmImage: 'windows-latest'

variables:
  - name: modulePath
    value: Hello.psm1

steps:
- task: PowerShell@2
  displayName: 'Create module archive'
  inputs:
    targetType: 'inline'
    script: |
      Set-Location $(modulePath)
      $moduleName = (Get-Item .).Name
      $moduleManifest = Get-Item -Path "*.psd1"
      $moduleVersion = (Import-PowerShellDataFile -Path $moduleManifest.FullName).ModuleVersion
      Compress-Archive -Path * -DestinationPath "../$moduleName.$moduleVersion.nupkg"

- task: NuGetAuthenticate@0
  displayName: 'NuGet Authenticate'

- task: NuGetCommand@2
  displayName: 'Push module to Azure DevOps Artifacts'
  inputs:
    command: 'push'
    packagesToPush: '$(Build.Repository.LocalPath)/*.nupkg'
    nuGetFeedType: 'internal'
    publishVstsFeed: 'LongjunTest/ps-private-module'